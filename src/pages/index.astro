---
import axios from "axios";
import { useSanityClient } from 'astro-sanity';

import Layout from "../layouts/Layout.astro";
import Footer from "../components/Footer.astro";
import Hero from "../components/Hero.astro";
import PhotographyGrid from "../components/PhotographyGrid.astro";

export const prerender = true

const data = await useSanityClient().fetch(`
  *[_type=='page' && slug.current == "home"][0] {
	..., 
	content[] {
		...,
		photographyGridItems[]{
			...,
			photography-> {
				_id,
				featuredImage,
				slug,
				title
			}
		}
	}
  }
`);

let content = data.content;

if(Astro.url.search.includes("?preview=true")){
	const fetchPreview = async () => {
		const response = await axios.get(
			`https://jeangillesphotography.netlify.app/.netlify/functions/preview?type=page&slug=home`
		);
		const { data } = await response.data;
		content = data.content;		
	}
	await fetchPreview();
}

---
<Layout>
	<h1 style="display:none;">Jean-Gilles Photography</h1>
	{content.map((section) => {
		switch (section._type) {
			case "hero":
				return 	<Hero />;
			case "photographyGrid":
				return <PhotographyGrid data={section} />;
			// case "textHeadline":
			// 	return <TextHeadline data={section} />;
		}
	})}	
	<Footer />
</Layout>
